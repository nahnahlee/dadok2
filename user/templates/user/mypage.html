{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>My Page</h1>
    <p>Username: {{ user.username }}</p>
    <p>Email: {{ user.email }}</p>
    <p>Nickname: {{ user.nickname }}</p>

    <!-- Delete Account Button -->
    <button id="deleteAccountBtn" style="background-color: red; color: white;">Delete Account</button>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid gray; padding: 20px; z-index: 1000;">
        <p>Do you really want to delete your account?</p>
        <button id="confirmDelete" style="background-color: red; color: white;">Yes</button>
        <button id="cancelDelete">No</button>
    </div>
</div>

<script>
    document.getElementById('deleteAccountBtn').addEventListener('click', function () {
        // Show the confirmation modal
        document.getElementById('confirmationModal').style.display = 'block';
    });

    document.getElementById('cancelDelete').addEventListener('click', function () {
        // Hide the confirmation modal
        document.getElementById('confirmationModal').style.display = 'none';
    });

    document.getElementById('confirmDelete').addEventListener('click', function () {
        // Send DELETE request to delete the account
        fetch('/user/delete/', {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}', // CSRF 토큰 추가
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.status === 204) {
                // Redirect to home page after successful deletion
                alert("Account successfully deleted.");
                window.location.href = '/';
            } else {
                alert('Failed to delete account. Please try again.');
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    });
</script>
{% endblock %}

